<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>5&nbsp; Efficiency and Welfare Analysis – ADLLM</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../part02/multi-objective-opti.html" rel="next">
<link href="../part01/revenue-opti.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-4379b0ccadffce622b03caf4c46266b3.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-bdec3157979715d7154bb60f5aa24e58.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-4104e206323135730aa08c3113d84ebc.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../part02/efficiency.html">Multi-objective Opti</a></li><li class="breadcrumb-item"><a href="../part02/efficiency.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Efficiency and Welfare Analysis</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">ADLLM</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../outline.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Outline</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Classical MD</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part01/intro-md.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Mechanism Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part01/auction-theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Auction Theory Fundamentals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part01/ic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Incentive Compatibility and Truthfulness</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part01/revenue-opti.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Revenue Optimization and Optimal Auctions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Multi-objective Opti</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part02/efficiency.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Efficiency and Welfare Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part02/multi-objective-opti.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Multi-Objective Optimization Theory</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part02/multi-objective-md.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Multi-Objective Mechanism Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part02/fairness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Fairness in Mechanism Design</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Computational MD</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part03/computational-aspects-md.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Computational Aspects of Mechanism Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part03/learn-adapt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Learning and Adaptation in Mechanisms</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part03/platform-econ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Platform Economics and Two-Sided Markets</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">LLM Ads</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part04/llm-ads.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to LLM Advertising Markets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part04/llm-ads-moop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Multi-Objective LLM Advertising Mechanisms</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part04/llm-ads-experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Experimental Design and Empirical Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part04/future.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Implementation and Future Directions</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#chapter-introduction" id="toc-chapter-introduction" class="nav-link active" data-scroll-target="#chapter-introduction"><span class="header-section-number">5.1</span> Chapter Introduction</a></li>
  <li><a href="#intuitive-development-understanding-efficiency-through-examples" id="toc-intuitive-development-understanding-efficiency-through-examples" class="nav-link" data-scroll-target="#intuitive-development-understanding-efficiency-through-examples"><span class="header-section-number">5.2</span> Intuitive Development: Understanding Efficiency Through Examples</a>
  <ul class="collapse">
  <li><a href="#the-restaurant-recommendation-problem" id="toc-the-restaurant-recommendation-problem" class="nav-link" data-scroll-target="#the-restaurant-recommendation-problem"><span class="header-section-number">5.2.1</span> The Restaurant Recommendation Problem</a></li>
  <li><a href="#economic-intuition-behind-different-efficiency-concepts" id="toc-economic-intuition-behind-different-efficiency-concepts" class="nav-link" data-scroll-target="#economic-intuition-behind-different-efficiency-concepts"><span class="header-section-number">5.2.2</span> Economic Intuition Behind Different Efficiency Concepts</a></li>
  <li><a href="#platform-economics-and-two-sided-market-complications" id="toc-platform-economics-and-two-sided-market-complications" class="nav-link" data-scroll-target="#platform-economics-and-two-sided-market-complications"><span class="header-section-number">5.2.3</span> Platform Economics and Two-Sided Market Complications</a></li>
  <li><a href="#building-toward-formal-analysis" id="toc-building-toward-formal-analysis" class="nav-link" data-scroll-target="#building-toward-formal-analysis"><span class="header-section-number">5.2.4</span> Building Toward Formal Analysis</a></li>
  </ul></li>
  <li><a href="#mathematical-foundations-formal-efficiency-and-welfare-theory" id="toc-mathematical-foundations-formal-efficiency-and-welfare-theory" class="nav-link" data-scroll-target="#mathematical-foundations-formal-efficiency-and-welfare-theory"><span class="header-section-number">5.3</span> Mathematical Foundations: Formal Efficiency and Welfare Theory</a>
  <ul class="collapse">
  <li><a href="#allocative-efficiency-and-pareto-optimality" id="toc-allocative-efficiency-and-pareto-optimality" class="nav-link" data-scroll-target="#allocative-efficiency-and-pareto-optimality"><span class="header-section-number">5.3.1</span> Allocative Efficiency and Pareto Optimality</a></li>
  <li><a href="#social-welfare-functions-and-aggregation" id="toc-social-welfare-functions-and-aggregation" class="nav-link" data-scroll-target="#social-welfare-functions-and-aggregation"><span class="header-section-number">5.3.2</span> Social Welfare Functions and Aggregation</a></li>
  <li><a href="#platform-specific-welfare-analysis" id="toc-platform-specific-welfare-analysis" class="nav-link" data-scroll-target="#platform-specific-welfare-analysis"><span class="header-section-number">5.3.3</span> Platform-Specific Welfare Analysis</a></li>
  <li><a href="#welfare-analysis-in-multi-objective-mechanisms" id="toc-welfare-analysis-in-multi-objective-mechanisms" class="nav-link" data-scroll-target="#welfare-analysis-in-multi-objective-mechanisms"><span class="header-section-number">5.3.4</span> Welfare Analysis in Multi-Objective Mechanisms</a></li>
  </ul></li>
  <li><a href="#advanced-results-welfare-analysis-in-complex-settings" id="toc-advanced-results-welfare-analysis-in-complex-settings" class="nav-link" data-scroll-target="#advanced-results-welfare-analysis-in-complex-settings"><span class="header-section-number">5.4</span> Advanced Results: Welfare Analysis in Complex Settings</a>
  <ul class="collapse">
  <li><a href="#impossibility-results-and-fundamental-limitations" id="toc-impossibility-results-and-fundamental-limitations" class="nav-link" data-scroll-target="#impossibility-results-and-fundamental-limitations"><span class="header-section-number">5.4.1</span> Impossibility Results and Fundamental Limitations</a></li>
  <li><a href="#dynamic-welfare-considerations" id="toc-dynamic-welfare-considerations" class="nav-link" data-scroll-target="#dynamic-welfare-considerations"><span class="header-section-number">5.4.2</span> Dynamic Welfare Considerations</a></li>
  <li><a href="#welfare-measurement-challenges-in-ai-systems" id="toc-welfare-measurement-challenges-in-ai-systems" class="nav-link" data-scroll-target="#welfare-measurement-challenges-in-ai-systems"><span class="header-section-number">5.4.3</span> Welfare Measurement Challenges in AI Systems</a></li>
  </ul></li>
  <li><a href="#applications-and-implementation-llm-advertising-welfare-analysis" id="toc-applications-and-implementation-llm-advertising-welfare-analysis" class="nav-link" data-scroll-target="#applications-and-implementation-llm-advertising-welfare-analysis"><span class="header-section-number">5.5</span> Applications and Implementation: LLM Advertising Welfare Analysis</a>
  <ul class="collapse">
  <li><a href="#practical-welfare-measurement-framework" id="toc-practical-welfare-measurement-framework" class="nav-link" data-scroll-target="#practical-welfare-measurement-framework"><span class="header-section-number">5.5.1</span> Practical Welfare Measurement Framework</a></li>
  <li><a href="#empirical-welfare-analysis-example" id="toc-empirical-welfare-analysis-example" class="nav-link" data-scroll-target="#empirical-welfare-analysis-example"><span class="header-section-number">5.5.2</span> Empirical Welfare Analysis Example</a></li>
  <li><a href="#case-study-book-recommendation-welfare-analysis" id="toc-case-study-book-recommendation-welfare-analysis" class="nav-link" data-scroll-target="#case-study-book-recommendation-welfare-analysis"><span class="header-section-number">5.5.3</span> Case Study: Book Recommendation Welfare Analysis</a></li>
  <li><a href="#welfare-optimal-mechanism-design" id="toc-welfare-optimal-mechanism-design" class="nav-link" data-scroll-target="#welfare-optimal-mechanism-design"><span class="header-section-number">5.5.4</span> Welfare-Optimal Mechanism Design</a></li>
  </ul></li>
  <li><a href="#chapter-synthesis" id="toc-chapter-synthesis" class="nav-link" data-scroll-target="#chapter-synthesis"><span class="header-section-number">5.6</span> Chapter Synthesis</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">5.7</span> Exercises</a></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading"><span class="header-section-number">5.8</span> Further Reading</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../part02/efficiency.html">Multi-objective Opti</a></li><li class="breadcrumb-item"><a href="../part02/efficiency.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Efficiency and Welfare Analysis</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Efficiency and Welfare Analysis</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="chapter-introduction" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="chapter-introduction"><span class="header-section-number">5.1</span> Chapter Introduction</h2>
<p>Consider a user asking an LLM-powered assistant: “What’s the best laptop for college students?” The system could respond in multiple ways. A purely revenue-maximizing approach might feature the highest-bidding advertiser: “The premium UltraBook Pro at $2,500 offers cutting-edge performance.” Alternatively, a user welfare-focused response might recommend: “The StudentBook at $800 provides excellent value with all essential features for coursework.” Each approach serves different stakeholders—advertisers seeking visibility, platforms generating revenue, and users needing helpful recommendations.</p>
<p>This scenario illustrates the fundamental challenge in mechanism design: how do we evaluate and compare different allocation schemes when multiple parties have competing interests? Chapter 5 develops the theoretical framework for answering this question through formal efficiency and welfare analysis.</p>
<p><strong>Learning Objectives:</strong> By the end of this chapter, you should be able to:</p>
<ul>
<li>Define and distinguish between different concepts of economic efficiency (allocative, Pareto, social welfare maximization)</li>
<li>Understand various welfare functions and their philosophical foundations (utilitarian, egalitarian, Nash social welfare)</li>
<li>Apply welfare analysis to multi-sided platforms and LLM advertising markets</li>
<li>Measure and compare welfare outcomes across different mechanism designs</li>
<li>Recognize the connections between efficiency, fairness, and mechanism design</li>
</ul>
<p><strong>Chapter Roadmap:</strong> We begin with concrete examples to build intuition about efficiency concepts, then formalize these ideas mathematically. The chapter progresses through allocative efficiency fundamentals, social welfare functions, and their applications to platform economics. We conclude by examining welfare measurement in LLM advertising contexts, connecting efficiency analysis to the multi-objective mechanism design framework needed for your thesis research.</p>
<p><strong>Connection to LLM Mechanism Design:</strong> Efficiency analysis provides the foundation for evaluating trade-offs between revenue, quality, and fairness in LLM advertising. The concepts developed here directly support the multi-objective optimization framework central to your research, enabling you to formally characterize when mechanisms achieve desirable social outcomes and how to balance competing stakeholder interests.</p>
</section>
<section id="intuitive-development-understanding-efficiency-through-examples" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="intuitive-development-understanding-efficiency-through-examples"><span class="header-section-number">5.2</span> Intuitive Development: Understanding Efficiency Through Examples</h2>
<section id="the-restaurant-recommendation-problem" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="the-restaurant-recommendation-problem"><span class="header-section-number">5.2.1</span> The Restaurant Recommendation Problem</h3>
<p>To build intuition about efficiency concepts, consider an LLM helping users find restaurants. Three users submit queries, and three restaurants want to advertise:</p>
<p><strong>Users:</strong></p>
<ul>
<li>Alice (values Italian food highly, budget-conscious)</li>
<li>Bob (values convenience, willing to pay premium prices)</li>
<li>Carol (values unique experiences, moderate budget)</li>
</ul>
<p><strong>Restaurants:</strong></p>
<ul>
<li>Romano’s Italian (high quality, moderate prices)</li>
<li>QuickBite (fast service, premium prices)</li>
<li>Artisan Café (unique ambiance, moderate prices)</li>
</ul>
<p>The platform can recommend different restaurant-user pairings. Let’s examine three possible allocations:</p>
<p><strong>Allocation 1 (Revenue Maximizing):</strong></p>
<ul>
<li>Alice → QuickBite (mismatch: high price, wrong cuisine)</li>
<li>Bob → QuickBite (good match: convenience, willing to pay)</li>
<li>Carol → Artisan Café (good match: unique experience)</li>
</ul>
<p><strong>Allocation 2 (User Preference Matching):</strong></p>
<ul>
<li>Alice → Romano’s Italian (perfect match: cuisine and budget)</li>
<li>Bob → QuickBite (good match: convenience)</li>
<li>Carol → Artisan Café (good match: uniqueness)</li>
</ul>
<p><strong>Allocation 3 (Balanced):</strong></p>
<ul>
<li>Alice → Romano’s Italian (good match)</li>
<li>Bob → Artisan Café (acceptable: unique but convenient location)</li>
<li>Carol → QuickBite (mismatch: not unique, expensive)</li>
</ul>
<p>Which allocation is “best”? The answer depends on how we define efficiency and whose welfare we prioritize.</p>
</section>
<section id="economic-intuition-behind-different-efficiency-concepts" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="economic-intuition-behind-different-efficiency-concepts"><span class="header-section-number">5.2.2</span> Economic Intuition Behind Different Efficiency Concepts</h3>
<p><strong>Allocative Efficiency</strong> asks: Are resources allocated to their highest-valued uses? In our restaurant example, this means matching users with restaurants they value most highly. Allocation 2 appears most allocatively efficient because each user receives their preferred type of restaurant.</p>
<p><strong>Pareto Efficiency</strong> asks: Can we improve someone’s outcome without making anyone else worse off? An allocation is Pareto efficient if no such improvements exist. Allocation 1 might be Pareto efficient if changing it would reduce restaurant revenues enough to make platforms worse off, even though it would help Alice.</p>
<p><strong>Social Welfare Maximization</strong> asks: What allocation maximizes some aggregate measure of total well-being? This depends on how we aggregate individual utilities—do we simply sum them (utilitarian), focus on the worst-off person (maximin), or use some other aggregation rule?</p>
</section>
<section id="platform-economics-and-two-sided-market-complications" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="platform-economics-and-two-sided-market-complications"><span class="header-section-number">5.2.3</span> Platform Economics and Two-Sided Market Complications</h3>
<p>LLM advertising involves multi-sided platforms serving users, advertisers, and potentially content creators. This creates additional complexity:</p>
<p><strong>Network Effects:</strong> More users attract more advertisers, and more advertisers can improve service quality for users (through better content funding), but too many ads may degrade user experience.</p>
<p><strong>Cross-Subsidization:</strong> Platforms may operate at a loss on one side (free service to users) to maximize value on the other side (advertiser revenues). This makes traditional welfare analysis more complex.</p>
<p><strong>Quality Considerations:</strong> Unlike simple goods markets, the “product” (LLM responses) can vary in quality based on how ads are integrated. A response with well-integrated, relevant ads might provide higher user utility than ad-free responses with lower information quality.</p>
</section>
<section id="building-toward-formal-analysis" class="level3" data-number="5.2.4">
<h3 data-number="5.2.4" class="anchored" data-anchor-id="building-toward-formal-analysis"><span class="header-section-number">5.2.4</span> Building Toward Formal Analysis</h3>
<p>These intuitive examples reveal several key insights that we’ll formalize mathematically:</p>
<ol type="1">
<li><strong>Multiple Valid Efficiency Concepts:</strong> Different notions of efficiency can lead to different optimal allocations</li>
<li><strong>Distributional Concerns:</strong> Who benefits matters, not just total benefits</li>
<li><strong>Platform-Specific Challenges:</strong> Two-sided markets create interdependencies that complicate welfare analysis</li>
<li><strong>Quality-Quantity Trade-offs:</strong> More advertising might reduce experience quality but enable better service provision</li>
</ol>
<p>The remainder of this chapter develops formal tools for analyzing these trade-offs systematically.</p>
</section>
</section>
<section id="mathematical-foundations-formal-efficiency-and-welfare-theory" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="mathematical-foundations-formal-efficiency-and-welfare-theory"><span class="header-section-number">5.3</span> Mathematical Foundations: Formal Efficiency and Welfare Theory</h2>
<section id="allocative-efficiency-and-pareto-optimality" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="allocative-efficiency-and-pareto-optimality"><span class="header-section-number">5.3.1</span> Allocative Efficiency and Pareto Optimality</h3>
<p>We begin with fundamental efficiency concepts in mechanism design contexts.</p>
<p><strong>Definition 5.1 (Allocative Efficiency).</strong> Given a set of agents <span class="math inline">N = \{1, 2, \ldots, n\}</span> with valuations <span class="math inline">v_i</span> for outcomes, an allocation <span class="math inline">x = (x_1, \ldots, x_n)</span> is allocatively efficient if it maximizes total value: <span class="math display">x^* \in \arg\max_{x \in X} \sum_{i \in N} v_i x_i</span> where <span class="math inline">X</span> is the set of feasible allocations.</p>
<p>In LLM advertising, this means allocating ad slots to advertisers who value them most highly. However, we must be careful about what “value” means when advertisers have private information.</p>
<p><strong>Definition 5.2 (Ex-Post Allocative Efficiency).</strong> An allocation rule <span class="math inline">x(v)</span> is ex-post allocatively efficient if for all valuation profiles <span class="math inline">v = (v_1, \ldots, v_n)</span>: <span class="math display">x(v) \in \arg\max_{y \in X} \sum_{i \in N} v_i y_i</span></p>
<p><strong>Definition 5.3 (Pareto Efficiency).</strong> An allocation <span class="math inline">x</span> with associated payments <span class="math inline">p = (p_1, \ldots, p_n)</span> is Pareto efficient if there exists no alternative allocation <span class="math inline">x'</span> and payments <span class="math inline">p'</span> such that:</p>
<ul>
<li><span class="math inline">u_i(x', p') \geq u_i(x, p)</span> for all <span class="math inline">i \in N</span></li>
<li><span class="math inline">u_i(x', p') &gt; u_i(x, p)</span> for at least one <span class="math inline">i \in N</span></li>
<li>The mechanism satisfies participation constraints</li>
</ul>
<p>where <span class="math inline">u_i(x, p) = v_i x_i - p_i</span> is agent <span class="math inline">i</span>’s utility.</p>
<p><strong>Theorem 5.1 (Allocative Efficiency and Pareto Efficiency Relationship).</strong> In quasilinear environments with no wealth effects, every allocatively efficient mechanism is Pareto efficient, but the converse is not necessarily true.</p>
<p><em>Proof.</em> Suppose mechanism <span class="math inline">(x, p)</span> is allocatively efficient. Consider any alternative <span class="math inline">(x', p')</span> that Pareto dominates it. Since <span class="math inline">u_i(x', p') \geq u_i(x, p)</span> for all <span class="math inline">i</span> with at least one strict inequality: <span class="math display">\sum_i [v_i x'_i - p'_i] &gt; \sum_i [v_i x_i - p_i]</span></p>
<p>This implies <span class="math inline">\sum_i v_i x'_i - \sum_i p'_i &gt; \sum_i v_i x_i - \sum_i p_i</span>. If the mechanism must balance its budget (reasonable for many platforms), then <span class="math inline">\sum_i p'_i \geq 0</span> and <span class="math inline">\sum_i p_i \geq 0</span>, so <span class="math inline">\sum_i v_i x'_i &gt; \sum_i v_i x_i</span>, contradicting allocative efficiency of <span class="math inline">(x, p)</span>. □</p>
</section>
<section id="social-welfare-functions-and-aggregation" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="social-welfare-functions-and-aggregation"><span class="header-section-number">5.3.2</span> Social Welfare Functions and Aggregation</h3>
<p><strong>Definition 5.4 (Social Welfare Function).</strong> A social welfare function <span class="math inline">W: \mathbb{R}^n \rightarrow \mathbb{R}</span> aggregates individual utilities <span class="math inline">(u_1, \ldots, u_n)</span> into a social ranking. Common examples include:</p>
<ol type="1">
<li><strong>Utilitarian (Benthamite):</strong> <span class="math inline">W^U(u) = \sum_{i=1}^n u_i</span></li>
<li><strong>Maximin (Rawlsian):</strong> <span class="math inline">W^R(u) = \min_{i \in N} u_i</span></li>
<li><strong>Nash Social Welfare:</strong> <span class="math inline">W^N(u) = \prod_{i=1}^n u_i</span> (assuming <span class="math inline">u_i \geq 0</span>)</li>
<li><strong>Weighted Utilitarian:</strong> <span class="math inline">W^{WU}(u) = \sum_{i=1}^n w_i u_i</span> for weights <span class="math inline">w_i &gt; 0</span></li>
</ol>
<p>Each welfare function embodies different ethical principles and leads to different optimal allocations.</p>
<p><strong>Theorem 5.2 (Welfare Function Properties).</strong></p>
<ol type="1">
<li>Utilitarian welfare maximization yields allocatively efficient outcomes in quasilinear settings</li>
<li>Maximin welfare focuses exclusively on the worst-off agent’s utility</li>
<li>Nash social welfare provides a compromise between efficiency and equality</li>
</ol>
<p><em>Proof Outline:</em> (1) follows directly from quasilinearity. (2) and (3) require analyzing first-order conditions of the respective optimization problems. Details available in standard welfare economics texts. □</p>
</section>
<section id="platform-specific-welfare-analysis" class="level3" data-number="5.3.3">
<h3 data-number="5.3.3" class="anchored" data-anchor-id="platform-specific-welfare-analysis"><span class="header-section-number">5.3.3</span> Platform-Specific Welfare Analysis</h3>
<p>LLM advertising platforms create value for multiple stakeholder groups. We need to extend standard welfare analysis to account for these complexities.</p>
<p><strong>Definition 5.5 (Multi-Sided Platform Welfare).</strong> For a platform serving users <span class="math inline">U</span>, advertisers <span class="math inline">A</span>, and the platform operator <span class="math inline">P</span>, total welfare is: <span class="math display">W_{total} = W_U(u^U) + W_A(u^A) + W_P(\pi^P)</span> where:</p>
<ul>
<li><span class="math inline">u^U = (u_1^U, \ldots, u_{|U|}^U)</span> are user utilities</li>
<li><span class="math inline">u^A = (u_1^A, \ldots, u_{|A|}^A)</span> are advertiser utilities</li>
<li><span class="math inline">\pi^P</span> is platform profit</li>
</ul>
<p><strong>Key Challenge:</strong> User utilities depend on both ad integration quality and information value, creating interdependencies: <span class="math display">u_i^U = v_i^{info} \cdot \text{quality}(response_i) - \text{disutility}(ads_i) + \text{benefit}(ad\_content_i)</span></p>
<p><strong>Definition 5.6 (Quality-Adjusted Welfare).</strong> In LLM contexts where response quality varies with advertising: <span class="math display">W_{QA} = \sum_{i \in U} \left[ v_i \cdot q(x_i) - c_i(x_i) \right] + \sum_{j \in A} \left[ v_j x_j - p_j \right] + \sum_{j \in A} p_j</span> where <span class="math inline">q(x_i)</span> represents quality of response <span class="math inline">i</span> as a function of ad allocation <span class="math inline">x</span>, and <span class="math inline">c_i(x_i)</span> represents user <span class="math inline">i</span>’s cost from ad exposure.</p>
</section>
<section id="welfare-analysis-in-multi-objective-mechanisms" class="level3" data-number="5.3.4">
<h3 data-number="5.3.4" class="anchored" data-anchor-id="welfare-analysis-in-multi-objective-mechanisms"><span class="header-section-number">5.3.4</span> Welfare Analysis in Multi-Objective Mechanisms</h3>
<p><strong>Definition 5.7 (Multi-Objective Social Choice).</strong> A multi-objective social choice function maps valuation profiles to outcomes that optimize a vector of objectives: <span class="math display">f(v) \in \arg\max_{x \in X} \left( \sum_i v_i x_i, \sum_i q_i x_i, \text{fairness}(x) \right)</span></p>
<p>This creates a vector optimization problem requiring Pareto efficiency concepts.</p>
<p><strong>Definition 5.8 (Pareto Efficient Multi-Objective Allocation).</strong> An allocation <span class="math inline">x^*</span> is Pareto efficient in the multi-objective sense if there exists no <span class="math inline">x \in X</span> such that each objective is weakly improved and at least one is strictly improved.</p>
<p><strong>Theorem 5.3 (Scalarization and Multi-Objective Efficiency).</strong> An allocation <span class="math inline">x^*</span> is Pareto efficient for the multi-objective problem if and only if there exist weights <span class="math inline">\lambda = (\lambda_1, \lambda_2, \lambda_3)</span> with <span class="math inline">\lambda_i \geq 0</span> and <span class="math inline">\sum_i \lambda_i = 1</span> such that: <span class="math display">x^* \in \arg\max_{x \in X} \left[ \lambda_1 \sum_i v_i x_i + \lambda_2 \sum_i q_i x_i + \lambda_3 \text{fairness}(x) \right]</span></p>
<p><em>Proof.</em> This follows from the fundamental theorem of multi-objective optimization. The weights <span class="math inline">\lambda</span> represent the relative importance of each objective in the social planner’s preferences. □</p>
</section>
</section>
<section id="advanced-results-welfare-analysis-in-complex-settings" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="advanced-results-welfare-analysis-in-complex-settings"><span class="header-section-number">5.4</span> Advanced Results: Welfare Analysis in Complex Settings</h2>
<section id="impossibility-results-and-fundamental-limitations" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="impossibility-results-and-fundamental-limitations"><span class="header-section-number">5.4.1</span> Impossibility Results and Fundamental Limitations</h3>
<p>Real-world mechanism design often faces fundamental constraints that limit achievable welfare outcomes.</p>
<p><strong>Theorem 5.4 (Revenue-Efficiency Trade-off).</strong> In settings with private information, it is generally impossible to simultaneously achieve:</p>
<ol type="1">
<li>Allocative efficiency (maximize <span class="math inline">\sum_i v_i x_i</span>)</li>
<li>Revenue maximization (maximize <span class="math inline">\sum_i p_i</span>)</li>
<li>Individual rationality (<span class="math inline">u_i \geq 0</span> for all <span class="math inline">i</span>)</li>
<li>Incentive compatibility (truthful reporting optimal)</li>
</ol>
<p><em>Proof Sketch.</em> This follows from Myerson (1981). Revenue maximization requires using virtual valuations <span class="math inline">\psi_i(v_i) = v_i - \frac{1-F_i(v_i)}{f_i(v_i)}</span> rather than true valuations, leading to allocative inefficiency when <span class="math inline">\psi_i(v_i) \neq v_i</span>. □</p>
<p>This impossibility result is crucial for understanding why multi-objective mechanism design requires explicit trade-offs.</p>
<p><strong>Theorem 5.5 (Platform Competition and Welfare).</strong> In a duopoly of platforms competing for users and advertisers:</p>
<ol type="1">
<li>Competition may lead to excessive quality provision (overprovision relative to social optimum)</li>
<li>Alternatively, competition may lead to excessive advertising (underprovision of quality)</li>
<li>The welfare effects depend on the relative strength of network effects</li>
</ol>
<p><em>Proof Outline.</em> The result follows from analyzing equilibrium conditions in a two-sided market model with platform competition. Platforms may compete on quality to attract users (leading to overprovision) or compete on advertiser revenues (leading to over-advertising). □</p>
</section>
<section id="dynamic-welfare-considerations" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2" class="anchored" data-anchor-id="dynamic-welfare-considerations"><span class="header-section-number">5.4.2</span> Dynamic Welfare Considerations</h3>
<p>Static welfare analysis misses important temporal aspects of platform operations.</p>
<p><strong>Definition 5.9 (Dynamic Social Welfare).</strong> With discount factor <span class="math inline">\delta \in (0,1)</span>: <span class="math display">W_{dynamic} = \sum_{t=0}^{\infty} \delta^t W_t(u_t^U, u_t^A, \pi_t^P)</span></p>
<p><strong>Key Insight:</strong> Platforms may accept short-term welfare losses to build user bases or improve service quality, leading to higher long-term welfare.</p>
<p><strong>Theorem 5.6 (Optimal Dynamic Trade-offs).</strong> The optimal revenue-quality trade-off parameter <span class="math inline">\alpha_t</span> in period <span class="math inline">t</span> satisfies: <span class="math display">\alpha_t = \arg\max \sum_{s=t}^{\infty} \delta^{s-t} W_s(\alpha_t, user\_base_s(\alpha_t))</span></p>
<p>where <span class="math inline">user\_base_s(\alpha_t)</span> captures how current quality choices affect future user adoption.</p>
</section>
<section id="welfare-measurement-challenges-in-ai-systems" class="level3" data-number="5.4.3">
<h3 data-number="5.4.3" class="anchored" data-anchor-id="welfare-measurement-challenges-in-ai-systems"><span class="header-section-number">5.4.3</span> Welfare Measurement Challenges in AI Systems</h3>
<p>LLM advertising presents unique measurement challenges:</p>
<p><strong>1. Quality Quantification:</strong> How do we measure the quality benefit users receive from better information?</p>
<p><strong>2. Attention Costs:</strong> What is the welfare cost of user attention directed to advertising?</p>
<p><strong>3. Learning Effects:</strong> How do we account for platforms learning to provide better matches over time?</p>
<p><strong>Definition 5.10 (Attention-Adjusted Welfare).</strong> Accounting for limited user attention: <span class="math display">W_{attention} = \sum_i \left[ v_i \cdot \text{benefit}(response_i) - \theta_i \cdot \text{attention\_cost}(ads_i) \right] + \text{advertiser and platform terms}</span></p>
<p>where <span class="math inline">\theta_i</span> represents user <span class="math inline">i</span>’s cost per unit of attention allocated to advertising.</p>
</section>
</section>
<section id="applications-and-implementation-llm-advertising-welfare-analysis" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="applications-and-implementation-llm-advertising-welfare-analysis"><span class="header-section-number">5.5</span> Applications and Implementation: LLM Advertising Welfare Analysis</h2>
<section id="practical-welfare-measurement-framework" class="level3" data-number="5.5.1">
<h3 data-number="5.5.1" class="anchored" data-anchor-id="practical-welfare-measurement-framework"><span class="header-section-number">5.5.1</span> Practical Welfare Measurement Framework</h3>
<p>To implement welfare analysis in LLM advertising, we need operational measures of each stakeholder’s utility.</p>
<p><strong>User Welfare Measurement:</strong></p>
<pre><code>Algorithm: Measure User Welfare
Input: Query q, Response r, Ads A integrated in r
Output: User welfare estimate

1. Content_Quality := semantic_similarity(r, ideal_response(q))
2. Ad_Relevance := average_relevance(A, q)
3. Integration_Quality := naturalness_score(r, A)
4. Attention_Cost := attention_time(A) × user_cost_rate
5. Return: w₁×Content_Quality + w₂×Ad_Relevance + w₃×Integration_Quality - Attention_Cost</code></pre>
<p><strong>Advertiser Welfare Measurement:</strong></p>
<pre><code>Algorithm: Measure Advertiser Welfare
Input: Advertiser i, Allocation x_i, Payment p_i, Query relevance q_i
Output: Advertiser welfare estimate

1. Expected_Clicks := x_i × q_i × base_click_rate
2. Expected_Value := Expected_Clicks × conversion_rate × value_per_conversion
3. Return: Expected_Value - p_i</code></pre>
<p><strong>Platform Welfare Measurement:</strong></p>
<pre><code>Algorithm: Measure Platform Welfare
Input: All payments P, Operating costs C, User satisfaction scores S
Output: Platform welfare estimate

1. Revenue := sum(P)
2. User_Retention_Value := future_value(S)
3. Operating_Profit := Revenue - C
4. Return: Operating_Profit + User_Retention_Value</code></pre>
</section>
<section id="empirical-welfare-analysis-example" class="level3" data-number="5.5.2">
<h3 data-number="5.5.2" class="anchored" data-anchor-id="empirical-welfare-analysis-example"><span class="header-section-number">5.5.2</span> Empirical Welfare Analysis Example</h3>
<p>Consider evaluating three mechanism designs for LLM advertising:</p>
<p><strong>Mechanism A (Pure Revenue):</strong> <span class="math inline">\alpha = 1.0</span></p>
<ul>
<li>Prioritizes highest bidders regardless of relevance</li>
<li>High advertiser payments, potentially low user satisfaction</li>
</ul>
<p><strong>Mechanism B (Balanced):</strong> <span class="math inline">\alpha = 0.5</span></p>
<ul>
<li>Balances revenue and quality considerations</li>
<li>Moderate payments, moderate user satisfaction</li>
</ul>
<p><strong>Mechanism C (Pure Quality):</strong> <span class="math inline">\alpha = 0.0</span></p>
<ul>
<li>Prioritizes relevance over payment ability</li>
<li>Lower payments, potentially higher user satisfaction</li>
</ul>
<p><strong>Welfare Comparison Framework:</strong></p>
<pre><code>Algorithm: Compare Mechanism Welfare
Input: Mechanisms M = {A, B, C}, User queries Q, Advertiser pool Ad
Output: Welfare comparison table

For each mechanism m in M:
    For each query q in Q:
        1. Run mechanism m on q with advertisers Ad
        2. Measure user welfare W_u(m,q)
        3. Measure advertiser welfare W_a(m,q)
        4. Measure platform welfare W_p(m,q)
        5. Calculate total welfare W_total(m,q)

    Aggregate welfare across queries for mechanism m

Return comparative welfare analysis</code></pre>
</section>
<section id="case-study-book-recommendation-welfare-analysis" class="level3" data-number="5.5.3">
<h3 data-number="5.5.3" class="anchored" data-anchor-id="case-study-book-recommendation-welfare-analysis"><span class="header-section-number">5.5.3</span> Case Study: Book Recommendation Welfare Analysis</h3>
<p>Let’s apply welfare analysis to the book recommendation scenario from the main paper.</p>
<p><strong>Setup:</strong></p>
<ul>
<li>Query: “Suggest books similar to ‘To Kill a Mockingbird’”</li>
<li>Advertisers: BookHaven, MassMart, EspressoEdge, Velora</li>
<li>User values relevant book recommendations highly</li>
</ul>
<p><strong>Mechanism A Output (Revenue-Focused):</strong> “For books similar to ‘To Kill a Mockingbird,’ visit MassMart for electronics and general merchandise, or try EspressoEdge coffee while reading.”</p>
<p><strong>Welfare Analysis A:</strong></p>
<ul>
<li>User Welfare: Low (poor relevance, -2.5 utils)</li>
<li>Advertiser Welfare: Medium (high-bidders win, +3.2 utils)</li>
<li>Platform Welfare: High (high revenue, +4.1 utils)</li>
<li>Total: +4.8 utils</li>
</ul>
<p><strong>Mechanism B Output (Balanced):</strong> “Try ‘The Help’ by Kathryn Stockett, available at BookHaven, which offers great book selections and reliable delivery for your reading needs.”</p>
<p><strong>Welfare Analysis B:</strong></p>
<ul>
<li>User Welfare: High (relevant recommendation, +4.2 utils)</li>
<li>Advertiser Welfare: Medium (relevant advertiser wins, +2.8 utils)</li>
<li>Platform Welfare: Medium (moderate revenue, +2.7 utils)</li>
<li>Total: +9.7 utils</li>
</ul>
<p><strong>Key Insight:</strong> The balanced mechanism achieves higher total welfare despite lower platform revenue, suggesting potential benefits from incorporating quality considerations.</p>
</section>
<section id="welfare-optimal-mechanism-design" class="level3" data-number="5.5.4">
<h3 data-number="5.5.4" class="anchored" data-anchor-id="welfare-optimal-mechanism-design"><span class="header-section-number">5.5.4</span> Welfare-Optimal Mechanism Design</h3>
<p><strong>Problem Formulation:</strong> Design mechanism that maximizes expected total welfare: <span class="math display">\max_{(\text{allocation rule}, \text{payment rule})} \mathbb{E}[W_U + W_A + W_P]</span> subject to incentive compatibility and individual rationality constraints.</p>
<p><strong>Solution Approach:</strong></p>
<ol type="1">
<li>Characterize welfare function in terms of allocation probabilities</li>
<li>Use optimal mechanism design techniques to find welfare-maximizing allocation</li>
<li>Apply revenue equivalence to determine corresponding payments</li>
<li>Verify that resulting mechanism satisfies participation constraints</li>
</ol>
<p><strong>Theorem 5.7 (Welfare Optimal LLM Advertising).</strong> The welfare-optimal mechanism for LLM advertising uses allocation probabilities: <span class="math display">x_i^*(v, q) = \frac{(v_i + \gamma q_i) \cdot \mathbf{1}_{v_i + \gamma q_i \geq \max_j\{v_j + \gamma q_j\}}}{\text{probability of allocation}}</span> where <span class="math inline">\gamma &gt; 0</span> represents the relative social value of quality versus revenue.</p>
<p>This shows that welfare optimization naturally leads to a balanced consideration of both advertiser values and relevance scores.</p>
</section>
</section>
<section id="chapter-synthesis" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="chapter-synthesis"><span class="header-section-number">5.6</span> Chapter Synthesis</h2>
<p>This chapter has developed the theoretical foundation for evaluating efficiency and welfare in mechanism design, with particular attention to multi-sided platforms and LLM advertising applications. The key insights are:</p>
<p><strong>Conceptual Foundations:</strong></p>
<ul>
<li>Multiple valid concepts of efficiency (allocative, Pareto, social welfare maximization) can lead to different optimal mechanisms</li>
<li>Platform economics introduces additional complexity through network effects and cross-subsidization</li>
<li>Multi-objective settings require explicit trade-offs between competing welfare criteria</li>
</ul>
<p><strong>Formal Framework:</strong></p>
<ul>
<li>Social welfare functions provide a principled way to aggregate stakeholder interests</li>
<li>Pareto efficiency concepts extend naturally to multi-objective mechanism design</li>
<li>Impossibility results constrain what can be achieved simultaneously</li>
</ul>
<p><strong>LLM Advertising Applications:</strong></p>
<ul>
<li>Welfare analysis must account for quality effects, attention costs, and relevance matching</li>
<li>Empirical welfare measurement requires operational proxies for user and advertiser utility</li>
<li>Balanced mechanisms may achieve higher total welfare than pure revenue maximization</li>
</ul>
<p><strong>Connection to Multi-Objective Research:</strong> These welfare analysis tools provide the foundation for your thesis research by:</p>
<ol type="1">
<li>Offering formal frameworks for characterizing trade-offs between revenue, quality, and fairness</li>
<li>Providing measurement approaches for empirical welfare analysis</li>
<li>Establishing theoretical benchmarks (welfare-optimal mechanisms) for comparison</li>
<li>Connecting individual mechanism properties to broader social outcomes</li>
</ol>
<p><strong>Key Research Implications:</strong></p>
<ul>
<li>Your empirical work should measure welfare across different stakeholder groups</li>
<li>Theoretical analysis should consider multiple welfare criteria beyond platform revenue</li>
<li>Policy analysis should account for total welfare effects, not just platform or advertiser outcomes</li>
</ul>
<p>The next chapter builds on these welfare concepts to develop multi-objective optimization theory, providing the mathematical tools for formally characterizing and solving the trade-off problems central to your thesis research.</p>
</section>
<section id="exercises" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="exercises"><span class="header-section-number">5.7</span> Exercises</h2>
<p><strong>Exercise 5.1 (Basic Efficiency Concepts)</strong> Consider three advertisers with valuations <span class="math inline">v_1 = 10</span>, <span class="math inline">v_2 = 8</span>, <span class="math inline">v_3 = 6</span> competing for two ad slots. a) What allocation maximizes total value (allocative efficiency)? b) If payments are <span class="math inline">p_1 = 5</span>, <span class="math inline">p_2 = 3</span>, <span class="math inline">p_3 = 0</span>, calculate each advertiser’s utility. c) Is this allocation Pareto efficient? Explain your reasoning.</p>
<p><strong>Exercise 5.2 (Social Welfare Functions)</strong> Given utility profile <span class="math inline">u = (3, 7, 5)</span> for three agents: a) Calculate utilitarian social welfare <span class="math inline">W^U(u)</span> b) Calculate maximin social welfare <span class="math inline">W^R(u)</span> c) Calculate Nash social welfare <span class="math inline">W^N(u)</span> d) Which welfare function would you choose to prioritize equality? Efficiency?</p>
<p><strong>Exercise 5.3 (Platform Welfare Analysis)</strong> An LLM platform serves users who value response quality at <span class="math inline">v_u = 20</span> per unit and dislike ads at cost <span class="math inline">c_u = 3</span> per ad. Advertisers value slots at <span class="math inline">v_a = 15</span> and pay <span class="math inline">p_a = 12</span>. a) Calculate total welfare for allocation with 2 ads integrated naturally (quality = 0.9) b) Calculate total welfare for allocation with 0 ads (quality = 1.0)<br>
c) What is the welfare-optimal number of ads?</p>
<p><strong>Exercise 5.4 (Multi-Objective Trade-offs)</strong> A mechanism designer wants to maximize weighted welfare <span class="math inline">W = \lambda R + (1-\lambda) Q</span> where <span class="math inline">R</span> is revenue and <span class="math inline">Q</span> is quality. a) If <span class="math inline">\lambda = 0.7</span>, does this prioritize revenue or quality? b) Derive the first-order condition for optimal allocation c) How does the optimal allocation change as <span class="math inline">\lambda</span> increases from 0 to 1?</p>
<p><strong>Exercise 5.5 (LLM Advertising Welfare)</strong> Design a welfare measurement framework for book recommendation queries: a) List three components of user welfare and how to measure each b) List two components of advertiser welfare and measurement approaches c) Explain how platform welfare depends on both short-term revenue and long-term user retention</p>
<p><strong>Exercise 5.6 (Impossibility Results)</strong> Explain why it’s generally impossible to simultaneously achieve:</p>
<ul>
<li>Perfect allocative efficiency</li>
<li>Maximum platform revenue</li>
<li>Individual rationality for all participants</li>
<li>Truthful bidding as a dominant strategy</li>
</ul>
<p>Use a simple example with two advertisers to illustrate the tension.</p>
<p><strong>Exercise 5.7 (Advanced Application)</strong> Consider the revenue-quality trade-off parameter <span class="math inline">\alpha \in [0,1]</span> from your thesis research: a) Express total welfare as a function of <span class="math inline">\alpha</span>, user utilities, and advertiser utilities b) Derive the welfare-optimal value of <span class="math inline">\alpha^*</span> c) Under what conditions will <span class="math inline">\alpha^* \neq \alpha^{revenue}</span> (the platform’s privately optimal choice)?</p>
</section>
<section id="further-reading" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="further-reading"><span class="header-section-number">5.8</span> Further Reading</h2>
<p><strong>Foundational Welfare Economics:</strong></p>
<ul>
<li>Mas-Colell, A., Whinston, M. D., &amp; Green, J. R. (1995). <em>Microeconomic Theory</em>, Chapters 16-17. Oxford University Press.</li>
<li>Tirole, J. (1988). <em>The Theory of Industrial Organization</em>, Chapter 1. MIT Press.</li>
</ul>
<p><strong>Mechanism Design and Efficiency:</strong></p>
<ul>
<li>Myerson, R. B. (1991). <em>Game Theory: Analysis of Conflict</em>, Chapters 6-7. Harvard University Press.</li>
<li>Krishna, V. (2009). <em>Auction Theory</em>, Chapter 3. Academic Press.</li>
</ul>
<p><strong>Multi-Sided Platform Economics:</strong></p>
<ul>
<li>Rochet, J. C., &amp; Tirole, J. (2003). Platform competition in two-sided markets. <em>Journal of the European Economic Association</em>, 1(4), 990-1029.</li>
<li>Armstrong, M. (2006). Competition in two-sided markets. <em>RAND Journal of Economics</em>, 37(3), 668-691.</li>
</ul>
<p><strong>Social Choice and Welfare:</strong></p>
<ul>
<li>Sen, A. K. (2017). <em>Collective Choice and Social Welfare</em>. Harvard University Press.</li>
<li>Moulin, H. (2003). <em>Fair Division and Collective Welfare</em>. MIT Press.</li>
</ul>
<p><strong>Multi-Objective Optimization:</strong></p>
<ul>
<li>Ehrgott, M. (2005). <em>Multicriteria Optimization</em>, Chapters 1-3. Springer.</li>
<li>Miettinen, K. (2012). <em>Nonlinear Multiobjective Optimization</em>. Springer.</li>
</ul>
<p><strong>Recent Applications to Digital Markets:</strong></p>
<ul>
<li>Cabral, L. (2019). Attention intermediaries. <em>American Economic Journal: Microeconomics</em>, 11(4), 103-130.</li>
<li>Hagiu, A., &amp; Wright, J. (2020). Multi-sided platforms. <em>International Journal of Industrial Organization</em>, 43, 162-174.</li>
</ul>
<p><strong>LLM and AI Economics:</strong></p>
<ul>
<li>Agrawal, A., Gans, J., &amp; Goldfarb, A. (2018). <em>Prediction Machines: The Simple Economics of Artificial Intelligence</em>. Harvard Business Review Press.</li>
<li>Recent papers on AI mechanism design in venues like EC, WINE, and AAAI conferences.</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../part01/revenue-opti.html" class="pagination-link" aria-label="Revenue Optimization and Optimal Auctions">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Revenue Optimization and Optimal Auctions</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../part02/multi-objective-opti.html" class="pagination-link" aria-label="Multi-Objective Optimization Theory">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Multi-Objective Optimization Theory</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>